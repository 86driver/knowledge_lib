## [vue数据绑定原理]

- initState方法





## Vue的选项配置合并

- el的合并

  `el`提供一个在页面上已存在的 `DOM` 元素作为 `Vue` 实例的挂载目标,因此它只在创建`Vue`实例才存在，在子类或者子组件中无法定义`el`选项，因此`el`的合并策略是在保证选项只存在于根的`Vue`实例的情形下使用默认策略进行合并。

- data的合并

  合并的原则是，将父类的数据整合到子类的数据选项中， 如若父类数据和子类数据冲突时，保留子类数据。如果对象有深层嵌套，则需要递归调用`mergeData`进行数据合并

  - FAQ:

    Q：为什么`Vue`组件的`data`是一个函数，而不是一个对象呢？

    A：**避免造成数据污染**， 因为如果data是一个对象的时候， 子组件在合并data的时候合并的是一个引用， 改变引用会造成数据的污染，为了复用原则， 应该返回一个函数创建的副本，这样才不会造成组件之前的数据污染。

- 自带资源选项合并

  对于 `directives、filters` 以及 `components` 等资源选项，父类选项将以原型链的形式被处理。子类必须通过原型链才能查找并使用内置组件和内置指令。

- 生命周期钩子函数的合并

  1. 如果子类和父类都拥有相同钩子选项，则将子类选项和父类选项合并。
  2. 如果父类不存在钩子选项，子类存在时，则以数组形式返回子类钩子选项。
  3. 当子类不存在钩子选项时，则以父类选项返回。
  4. 子父合并时，是将子类选项放在数组的末尾，这样在执行钩子时，永远是父类选项优先于子类选项执行。

  

- watch选项合并

  对于watch选项的合并，最终和父类选项合并成数组，并且数组的选项成员，可以是回调函数，选项对象，或者函数名。

- props methods inject computed合并

  源码的设计将`props.methods,inject,computed`归结为一类，他们的配置策略一致，简单概括就是，如果父类不存在选项，则返回子类选项，子类父类都存在时，用子类选项去覆盖父类选项。

  
